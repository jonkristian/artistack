// Platform detection, icons, and colors utility
// Shared between client and server components

export type PlatformCategory = 'streaming' | 'social' | 'event' | 'other';

export interface PlatformInfo {
  platform: string;
  category: PlatformCategory;
}

/**
 * SVG path data for platform icons (24x24 viewBox)
 */
export const platformIcons: Record<string, string> = {
  // Streaming
  spotify:
    'M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z',
  apple_music:
    'M23.997 6.124c0-.738-.065-1.47-.24-2.19-.317-1.31-1.062-2.31-2.18-3.043C21.003.517 20.373.285 19.7.164c-.517-.093-1.038-.135-1.564-.15-.04-.003-.083-.01-.124-.013H5.988c-.152.01-.303.017-.455.026C4.786.07 4.043.15 3.34.428 2.004.958 1.04 1.88.475 3.208c-.192.448-.292.925-.363 1.408-.056.392-.088.785-.1 1.18 0 .032-.007.062-.01.093v12.223c.01.14.017.283.027.424.05.815.154 1.62.497 2.373.518 1.14 1.39 1.94 2.547 2.443.477.207.98.327 1.494.39.65.077 1.303.098 1.956.098H18.49c.193 0 .387-.015.58-.024.63-.03 1.26-.097 1.864-.283 1.27-.39 2.244-1.13 2.913-2.26.332-.56.53-1.17.635-1.81.094-.57.137-1.143.147-1.72.002-.045.01-.09.01-.135V6.125h-.003zm-4.62 7.068c-.02 1.442-.216 2.854-.718 4.216-.343.932-.833 1.764-1.65 2.388-.586.447-1.253.688-1.98.768-.526.057-.848-.097-1.06-.588-.16-.37-.25-.76-.29-1.16-.06-.577.05-1.13.22-1.67.35-1.1.94-2.05 1.66-2.93.435-.53.916-1.01 1.41-1.48.27-.257.43-.568.49-.93.07-.43.06-.86.01-1.29-.04-.375-.19-.687-.54-.863-.15-.077-.32-.077-.48-.03-.28.082-.52.23-.74.41-.77.645-1.38 1.42-1.93 2.25-.86 1.3-1.5 2.71-1.99 4.19-.29.87-.51 1.76-.64 2.67-.07.51-.11 1.02-.09 1.53.02.54.14 1.06.41 1.53.36.65.91 1.06 1.64 1.24.61.15 1.22.12 1.82-.05 1.09-.31 1.97-.92 2.7-1.73.69-.77 1.18-1.66 1.54-2.62.5-1.33.72-2.72.75-4.14V6.813c0-.243-.01-.485-.05-.725-.05-.305-.17-.58-.41-.79-.31-.27-.69-.3-1.05-.19-.41.13-.71.41-.95.76-.21.3-.38.63-.53.97-.35.79-.57 1.62-.7 2.47-.05.32-.08.65-.09.98v3.897z',
  youtube:
    'M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z',
  youtube_music:
    'M12 0C5.376 0 0 5.376 0 12s5.376 12 12 12 12-5.376 12-12S18.624 0 12 0zm0 19.104c-3.924 0-7.104-3.18-7.104-7.104S8.076 4.896 12 4.896s7.104 3.18 7.104 7.104-3.18 7.104-7.104 7.104zm0-13.332c-3.432 0-6.228 2.796-6.228 6.228S8.568 18.228 12 18.228s6.228-2.796 6.228-6.228S15.432 5.772 12 5.772zM9.684 15.54V8.46L15.816 12l-6.132 3.54z',
  soundcloud:
    'M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154.233 2.105c.007.058.05.098.101.098.05 0 .09-.04.099-.098l.255-2.105-.27-2.154c-.009-.06-.05-.1-.1-.1m-.899.828c-.06 0-.091.037-.104.094L0 14.479l.165 1.308c.014.057.045.094.09.094.044 0 .074-.037.09-.094l.195-1.308-.196-1.332c-.015-.057-.046-.094-.09-.094m1.83-1.229c-.061 0-.12.045-.12.104l-.21 2.563.225 2.458c0 .06.045.104.106.104.061 0 .12-.044.12-.104l.24-2.458-.24-2.563c0-.06-.059-.104-.12-.104m.945-.089c-.075 0-.135.06-.15.135l-.193 2.64.21 2.544c.016.077.075.138.149.138.075 0 .135-.061.15-.138l.24-2.544-.24-2.64c-.015-.074-.074-.135-.15-.135m1.155.36c-.005-.09-.075-.149-.159-.149-.09 0-.158.06-.164.149l-.217 2.43.2 2.563c0 .09.075.157.163.157.074 0 .149-.068.158-.158l.227-2.563-.227-2.43m.809-1.709c-.09 0-.18.089-.18.18l-.195 4.14.18 2.584c0 .09.09.18.18.18.094 0 .174-.09.18-.18l.209-2.583-.209-4.14c-.006-.091-.086-.181-.18-.181m.959-.914c-.105 0-.195.09-.195.195l-.18 5.04.165 2.625c0 .104.09.195.195.195.094 0 .194-.091.195-.195l.195-2.625-.195-5.04c0-.105-.09-.195-.195-.195m1.005.645c-.015-.045-.06-.15-.195-.15-.135 0-.195.105-.21.15l-.157 4.352.17 2.64c.015.09.076.194.21.194.105 0 .18-.089.195-.194l.18-2.64-.18-4.352m1.215-.705c-.039-.105-.104-.195-.24-.195-.137 0-.225.09-.255.195l-.21 4.4.225 2.67c.015.121.12.225.255.225.12 0 .225-.104.24-.225l.24-2.67-.255-4.4m1.17-.42c-.18 0-.24.15-.255.24l-.21 4.56.24 2.685c.015.149.12.254.255.254.135 0 .24-.12.255-.254l.255-2.686-.27-4.56c-.015-.089-.075-.24-.255-.24m1.166-.44c-.075-.015-.165-.195-.315-.195-.15 0-.24.18-.255.195l-.24 4.755.255 2.685c.015.164.135.29.285.29.15 0 .27-.12.285-.29l.27-2.685-.27-4.755m1.605-.48c-.165 0-.3.135-.315.315l-.225 4.92.24 2.685c.015.18.15.315.315.315.165 0 .3-.135.315-.315l.27-2.685-.27-4.92c-.015-.18-.149-.315-.315-.315m1.185.015c-.15 0-.315.15-.315.33l-.24 4.905.255 2.67c0 .18.149.33.315.33.149 0 .314-.15.314-.33l.27-2.67-.27-4.905c0-.18-.164-.33-.314-.33m1.14-.66c-.194 0-.344.15-.359.36l-.24 5.55.255 2.655c.015.195.165.36.359.36.18 0 .344-.165.359-.36l.27-2.655-.27-5.55c-.015-.21-.179-.36-.359-.36m1.23-.315c-.21 0-.375.165-.39.39l-.24 5.85.254 2.64c.015.21.18.39.39.39.195 0 .375-.18.375-.39l.27-2.64-.27-5.85c0-.225-.165-.39-.375-.39m1.249-.045c-.015-.21-.18-.39-.405-.39-.225 0-.39.18-.404.39l-.24 5.895.255 2.625c.015.225.18.39.405.39.225 0 .405-.165.405-.39l.27-2.625-.27-5.895m1.125.15c-.21 0-.405.18-.42.405l-.225 5.73.225 2.61c.015.225.21.405.42.405.21 0 .405-.18.42-.405l.255-2.61-.255-5.73c-.015-.225-.21-.405-.42-.405m1.005.195c-.21 0-.42.18-.435.42l-.21 5.52.21 2.595c.015.24.225.435.435.435.21 0 .42-.195.435-.435l.24-2.595-.24-5.52c-.015-.24-.225-.42-.435-.42m1.755-.36c-.269 0-.45.21-.465.465l-.21 5.625.225 2.565c.015.255.21.465.45.465.255 0 .45-.21.465-.465l.24-2.565-.24-5.625c-.015-.255-.21-.465-.465-.465m1.635 4.305c-.255 0-.45.21-.465.465l-.21 5.565.21 2.55c.015.27.21.465.465.465.24 0 .45-.195.465-.465l.225-2.55-.225-5.565c-.015-.255-.225-.465-.465-.465m1.785-4.965c-.256 0-.465.225-.48.48l-.21 5.415.21 2.52c.015.27.225.48.48.48.24 0 .465-.21.48-.48l.225-2.52-.24-5.415c-.015-.255-.225-.48-.48-.48m1.095.3c-.256 0-.48.24-.48.495l-.195 5.115.195 2.505c0 .27.225.495.48.495.255 0 .48-.225.48-.495l.21-2.505-.21-5.115c0-.255-.225-.495-.48-.495m-14.29 8.52c-.254 0-.465.225-.48.495l-.21 2.115.225 2.145c.015.27.225.495.48.495.24 0 .45-.225.465-.495l.255-2.145-.255-2.115c-.015-.27-.225-.495-.465-.495',
  bandcamp: 'M0 18.75l7.437-13.5H24l-7.438 13.5H0z',
  deezer:
    'M19.6 3.6h4.4v2.4h-4.4V3.6zm0 4.8h4.4v2.4h-4.4V8.4zm0 4.8h4.4v2.4h-4.4v-2.4zm0 4.8h4.4v2.4h-4.4v-2.4zM9.8 13.2h4.4v2.4H9.8v-2.4zm0 4.8h4.4v2.4H9.8v-2.4zM0 13.2h4.4v2.4H0v-2.4zm0 4.8h4.4v2.4H0v-2.4zm9.8-9.6h4.4v2.4H9.8V8.4zm9.8 0h4.4v2.4h-4.4V8.4z',
  tidal:
    'M12.012 3.992L8.008 7.996 4.004 3.992 0 7.996l4.004 4.004-4.004 4.004 4.004 4.004 4.004-4.004 4.004 4.004 4.004-4.004-4.004-4.004 4.004-4.004-4.004-4.004zm7.992 0l-4.004 4.004 4.004 4.004L24 7.996l-4.004-4.004z',

  // Social
  instagram:
    'M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.757-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z',
  tiktok:
    'M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z',
  twitter:
    'M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z',
  facebook:
    'M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z',

  // Event platforms
  bandsintown: 'M2 2h6v20H2V2zm7 10h6v10H9V12zm7-5h6v15h-6V7z',
  eventbrite:
    'M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 17.08c-1.837 1.837-4.428 2.534-6.922 1.952l3.47-3.47c.39-.39.39-1.023 0-1.414-.39-.39-1.023-.39-1.414 0l-3.47 3.47c-.582-2.494.115-5.085 1.952-6.922 1.837-1.837 4.428-2.534 6.922-1.952l-3.47 3.47c-.39.39-.39 1.023 0 1.414.39.39 1.023.39 1.414 0l3.47-3.47c.582 2.494-.115 5.085-1.952 6.922z',
  songkick:
    'M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm4.5 17.25h-9v-1.5h9v1.5zm0-3h-9v-1.5h9v1.5zm0-3h-9v-1.5h9v1.5zm0-3h-9v-1.5h9v1.5z',
  dice: 'M20.5 3h-17A1.5 1.5 0 002 4.5v15A1.5 1.5 0 003.5 21h17a1.5 1.5 0 001.5-1.5v-15A1.5 1.5 0 0020.5 3zM7 18a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0-6a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm5 3a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm5 3a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0-6a1.5 1.5 0 110-3 1.5 1.5 0 010 3z',
  seetickets:
    'M20 4H4c-1.1 0-2 .9-2 2v4c1.1 0 2 .9 2 2s-.9 2-2 2v4c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-4c-1.1 0-2-.9-2-2s.9-2 2-2V6c0-1.1-.9-2-2-2zm-2 6.5c0 .28-.22.5-.5.5h-11c-.28 0-.5-.22-.5-.5v-1c0-.28.22-.5.5-.5h11c.28 0 .5.22.5.5v1zm0 4c0 .28-.22.5-.5.5h-11c-.28 0-.5-.22-.5-.5v-1c0-.28.22-.5.5-.5h11c.28 0 .5.22.5.5v1z'
};

/**
 * Brand colors for platforms
 */
export const platformColors: Record<string, string> = {
  // Streaming
  spotify: '#1DB954',
  apple_music: '#FA243C',
  youtube: '#FF0000',
  youtube_music: '#FF0000',
  soundcloud: '#FF5500',
  bandcamp: '#629aa9',
  deezer: '#FEAA2D',
  tidal: '#000000',

  // Social
  instagram: '#E4405F',
  tiktok: '#000000',
  twitter: '#000000',
  facebook: '#1877F2',

  // Event platforms
  bandsintown: '#00CEC8',
  eventbrite: '#F05537',
  songkick: '#F80046',
  dice: '#121212',
  seetickets: '#E31837'
};

/**
 * URL patterns for platform detection
 */
const platformPatterns: Array<{ pattern: RegExp; platform: string; category: PlatformCategory }> = [
  // Streaming platforms
  { pattern: /open\.spotify\.com/i, platform: 'spotify', category: 'streaming' },
  { pattern: /music\.apple\.com/i, platform: 'apple_music', category: 'streaming' },
  { pattern: /music\.youtube\.com/i, platform: 'youtube_music', category: 'streaming' },
  { pattern: /soundcloud\.com/i, platform: 'soundcloud', category: 'streaming' },
  { pattern: /bandcamp\.com/i, platform: 'bandcamp', category: 'streaming' },
  { pattern: /deezer\.com/i, platform: 'deezer', category: 'streaming' },
  { pattern: /tidal\.com/i, platform: 'tidal', category: 'streaming' },

  // Social platforms
  { pattern: /instagram\.com/i, platform: 'instagram', category: 'social' },
  { pattern: /tiktok\.com/i, platform: 'tiktok', category: 'social' },
  { pattern: /(twitter\.com|x\.com)/i, platform: 'twitter', category: 'social' },
  { pattern: /facebook\.com(?!.*\/events)/i, platform: 'facebook', category: 'social' },
  { pattern: /(youtube\.com|youtu\.be)(?!.*music)/i, platform: 'youtube', category: 'social' },

  // Event platforms
  { pattern: /bandsintown\.com/i, platform: 'bandsintown', category: 'event' },
  { pattern: /eventbrite\.(com|co\.uk|de|fr|es)/i, platform: 'eventbrite', category: 'event' },
  { pattern: /songkick\.com/i, platform: 'songkick', category: 'event' },
  { pattern: /dice\.fm/i, platform: 'dice', category: 'event' },
  { pattern: /seetickets\.(com|us)/i, platform: 'seetickets', category: 'event' },
  { pattern: /facebook\.com\/events/i, platform: 'facebook', category: 'event' },
  { pattern: /fb\.me/i, platform: 'facebook', category: 'event' }
];

/**
 * Detects platform and category from a URL
 */
export function detectPlatformFromUrl(url: string): PlatformInfo | null {
  for (const { pattern, platform, category } of platformPatterns) {
    if (pattern.test(url)) {
      return { platform, category };
    }
  }
  return null;
}

/**
 * Gets the icon path for a platform
 */
export function getPlatformIcon(platform: string): string | null {
  return platformIcons[platform] ?? null;
}

/**
 * Gets the brand color for a platform
 */
export function getPlatformColor(platform: string, fallback = 'var(--theme-primary)'): string {
  return platformColors[platform] ?? fallback;
}

/**
 * Gets platform info from URL with icon and color
 */
export function getPlatformInfoFromUrl(url: string): {
  platform: string;
  category: PlatformCategory;
  icon: string | null;
  color: string;
} | null {
  const info = detectPlatformFromUrl(url);
  if (!info) return null;

  return {
    ...info,
    icon: getPlatformIcon(info.platform),
    color: getPlatformColor(info.platform)
  };
}

// ============================================================================
// ID Extraction Functions
// ============================================================================

/**
 * Extract Spotify artist ID from a Spotify URL
 * Supports: open.spotify.com/artist/ID, spotify:artist:ID
 */
export function extractSpotifyArtistId(url: string): string | null {
  try {
    // Handle spotify: URI format
    if (url.startsWith('spotify:artist:')) {
      return url.split(':')[2] || null;
    }

    const parsed = new URL(url);
    if (!parsed.hostname.includes('spotify.com')) return null;

    // Pattern: /artist/{id}
    const match = parsed.pathname.match(/\/artist\/([a-zA-Z0-9]+)/);
    return match?.[1] || null;
  } catch {
    return null;
  }
}

/**
 * Extract YouTube channel ID from a YouTube URL
 * Supports: youtube.com/channel/ID, youtube.com/@handle, youtube.com/c/name
 */
export function extractYouTubeChannelId(
  url: string
): { id: string; type: 'channel' | 'handle' | 'custom' } | null {
  try {
    const parsed = new URL(url);
    if (!parsed.hostname.includes('youtube.com') && !parsed.hostname.includes('youtu.be')) {
      return null;
    }

    // Pattern: /channel/UCxxxxxx
    const channelMatch = parsed.pathname.match(/\/channel\/([a-zA-Z0-9_-]+)/);
    if (channelMatch) {
      return { id: channelMatch[1], type: 'channel' };
    }

    // Pattern: /@handle
    const handleMatch = parsed.pathname.match(/\/@([a-zA-Z0-9_-]+)/);
    if (handleMatch) {
      return { id: handleMatch[1], type: 'handle' };
    }

    // Pattern: /c/customname or /user/username
    const customMatch = parsed.pathname.match(/\/(c|user)\/([a-zA-Z0-9_-]+)/);
    if (customMatch) {
      return { id: customMatch[2], type: 'custom' };
    }

    return null;
  } catch {
    return null;
  }
}

/**
 * Extract SoundCloud username from a SoundCloud URL
 */
export function extractSoundCloudUsername(url: string): string | null {
  try {
    const parsed = new URL(url);
    if (!parsed.hostname.includes('soundcloud.com')) return null;

    // Pattern: soundcloud.com/username
    const match = parsed.pathname.match(/^\/([a-zA-Z0-9_-]+)/);
    if (
      match &&
      !['discover', 'stream', 'search', 'upload', 'you', 'messages'].includes(match[1])
    ) {
      return match[1];
    }
    return null;
  } catch {
    return null;
  }
}
